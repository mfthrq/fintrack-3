{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  {% load static %}
  <link rel="shortcut icon" href="{% static 'img/uang.png' %}" />
  <title>FinTrack</title>

  <!-- Custom fonts for this template-->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <!-- Custom styles for this template -->
  {% load static %}
  <link href="{% static 'css/sb-admin-2.min.css' %}" rel="stylesheet">
</head>

<body id="page-top">
    <!-- Page Wrapper -->
    <div id="wrapper">
      <!-- Sidebar -->
      <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">
        <!-- Sidebar - Brand -->
        <a class="sidebar-brand d-flex align-items-center justify-content-center" href="{% url 'index' %}">
          
            {% comment %} <i class="fas fa-chart-pie"></i> {% endcomment %}
            <img src="{% static 'img/uang.png' %}" style="height: 50px; width: 50px;">
         
          <div class="sidebar-brand-text mx-3">FinTrack</div>
        </a>
  
        <!-- Divider -->
        <hr class="sidebar-divider my-0">
  
        <!-- Nav Item - Dashboard -->
        <li class="nav-item active">
          <a class="nav-link" href="{% url 'index' %}">
            <i class="fas fa-fw fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
        </li>
  
        <!-- Divider -->
        <hr class="sidebar-divider">
  
        <!-- Heading -->
        <div class="sidebar-heading">Transaksi</div>
  
        <!-- Nav Item - Pages Collapse Menu -->
        <li class="nav-item">
          <a class="nav-link collapsed" href="{% url 'pemasukan' %}">
            <i class="fas fa-fw fa-arrow-up"></i>
            <span>Pemasukan</span>
          </a>
        </li>
  
        <!-- Nav Item - Utilities Collapse Menu -->
        <li class="nav-item">
          <a class="nav-link collapsed" href="{% url 'pengeluaran' %}">
            <i class="fas fa-fw fa-arrow-down"></i>
            <span>Pengeluaran</span>
          </a>
        </li>
  
        <!-- Sidebar Toggler (Sidebar) -->
        <div class="text-center d-none d-md-inline">
          <button class="rounded-circle border-0" id="sidebarToggle"></button>
        </div>
      </ul>
      <!-- End of Sidebar -->    
  
      <!-- Content Wrapper -->
      <div id="content-wrapper" class="d-flex flex-column">
        <div id="content">
          <!-- Topbar -->
          <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
            <!-- Sidebar Toggle (Topbar) -->
            <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
              <i class="fa fa-bars"></i>
            </button>
  
            <!-- Topbar Search -->
            <h1 style="font-weight: 600; color: #4E73DF;">
              Dashboard
            </h1>
          </nav>
          <!-- End of Topbar -->
  
          <!-- Begin Page Content -->
          <div class="container-fluid">

              <!-- Content Row -->
              <div class="row">
                <!-- Earnings (Monthly) Card Example -->
                <div class="col-xl-3 col-md-6 mb-4">
                  <div class="card border-left-success shadow h-100 py-2">
                    <div class="card-body">
                      <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                          <div
                            class="text-md font-weight-bold text-success  mb-1"
                          >
                            Pendapatan 
                          </div>
                          <div class="h5 mb-0 font-weight-bold text-gray-800">
                            Rp{{ total_pemasukan|intcomma }}
                          </div>
                        </div>
                        <div class="col-auto">
                          <i class="fas fa-calendar fa-2x text-gray-300"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Earnings (Monthly) Card Example -->
                <div class="col-xl-3 col-md-6 mb-4">
                  <div class="card border-left-danger shadow h-100 py-2">
                    <div class="card-body">
                      <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                          <div
                            class="text-md font-weight-bold text-danger  mb-1"
                          >
                            Pengeluaran
                          </div>
                          <div class="h5 mb-0 font-weight-bold text-gray-800">
                            Rp{{ total_pengeluaran|intcomma }}
                          </div>
                        </div>
                        <div class="col-auto">
                          <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Earnings (Monthly) Card Example -->
                <div class="col-xl-3 col-md-6 mb-4">
                  <div class="card border-left-info shadow h-100 py-2">
                    <div class="card-body">
                      <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                          <div
                            class="text-md font-weight-bold text-info  mb-1"
                          >
                            Sisa Uang
                          </div>
                          <div class="row no-gutters align-items-center">
                            <div class="col-auto">
                              <div
                                class="h5 mb-0 mr-3 font-weight-bold text-gray-800"
                              >
                              Rp{{ sisa_uang|intcomma }}
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-auto">
                          <i
                            class="fas fa-clipboard-list fa-2x text-gray-300"
                          ></i>
                        </div>
                      </div>
                    </div>
                    {% comment %} <div class="col" style="height: auto;">
                      <div class="progress progress-sm mr-2" style="height: 100%;">
                        <div
                          class="progress-bar bg-info"
                          role="progressbar"
                          style="width: 100%; height: 100%;"
                          aria-valuenow=""
                          aria-valuemin="0"
                          aria-valuemax="100"
                        >
                          <span>19%</span>
                        </div>
                      </div>
                    </div> {% endcomment %}
                  </div>
                </div>
              </div>
    
              <!-- Content Row -->
              <div class="row">
                  <!-- Area Chart -->
                  <div class="col-xl-8 col-lg-7">
                    <div class="card shadow mb-4">
                      <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">Grafik Keuangan Bulanan</h6>
                        {% comment %} <div class="dropdown no-arrow">
                          <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                          </a>
                          <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                            <div class="dropdown-header">Dropdown Header:</div>
                            <a class="dropdown-item" href="#">Action</a>
                            <a class="dropdown-item" href="#">Another action</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Something else here</a>
                          </div>
                        </div> {% endcomment %}
                      </div>
                      <div class="card-body">
                        <div class="chart-area">
                          <canvas id="myAreaChart"></canvas>
                        </div>
                      </div>
                    </div>
                  </div>
                
                  <!-- Pie Chart -->
                  <div class="col-xl-4 col-lg-5">
                    <div class="card shadow mb-4">
                      <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">Perbandingan</h6>
                        {% comment %} <div class="dropdown no-arrow">
                          <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                          </a>
                          <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                            <div class="dropdown-header">Dropdown Header:</div>
                            <a class="dropdown-item" href="#">Action</a>
                            <a class="dropdown-item" href="#">Another action</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Something else here</a>
                          </div>
                        </div> {% endcomment %}
                      </div>
                      <div class="card-body">
                        <div class="chart-pie pt-4 pb-2">
                          <canvas id="myPieChart"></canvas>
                        </div>
                        <div class="mt-4 text-center small">
                          <span class="mr-2">
                            <i class="fas fa-circle text-primary"></i> Pemasukan
                          </span>
                          <span class="mr-2">
                            <i class="fas fa-circle text-danger"></i> Pengeluaran
                          </span>
                          <span class="mr-2">
                            <i class="fas fa-circle text-info"></i> Sisa
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>

              </div>
                
          </div>

          <footer class="sticky-footer bg-white">
              <div class="container my-auto">
                <div class="copyright text-center my-auto">
                  <span
                    >Copyright &copy; 2024 -
                    <a
                      href="#"
                      title="sharecodingan.blogspot.com"
                      target="_blank"
                      >Kelompok 4 BP2</a
                    ></span
                  >
                </div>
              </div>
          </footer>
          <!-- End of Main Content -->
        </div>
        <!-- End of Content Wrapper -->
      </div>
      <!-- End of Page Wrapper -->
  
      <!-- Scroll to Top Button-->
      <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
      </a>
  
      <!-- Bootstrap core JavaScript-->
      <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
      <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  
      <!-- Core plugin JavaScript-->
      <script src="{% static 'vendor/jquery-easing/jquery.easing.min.js' %}"></script>
  
      <!-- Custom scripts for all pages-->
      <script src="{% static 'js/sb-admin-2.min.js' %}"></script>
  
      <!-- Page level plugins -->
      <script src="{% static 'vendor/chart.js/Chart.min.js' %}"></script>

      <script>
        console.log("Income Data:", {{ income_data|safe }});
        // Data untuk chart area
        const areaData = {
          labels: ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"],
          datasets: [
          {
            label: "Pemasukan",
            lineTension: 0.3,
            backgroundColor: "rgba(78, 115, 223, 0.05)",
            borderColor: "rgba(78, 115, 223, 1)",
            pointRadius: 3,
            pointBackgroundColor: "rgba(78, 115, 223, 1)",
            pointBorderColor: "rgba(78, 115, 223, 1)",
            pointHoverRadius: 3,
            pointHoverBackgroundColor: "rgba(78, 115, 223, 1)",
            pointHoverBorderColor: "rgba(78, 115, 223, 1)",
            pointHitRadius: 10,
            pointBorderWidth: 2,
            data: {{ income_data|safe }}, // Ganti dengan data sesuai dengan kebutuhan Anda
          },
          {
            label: "Pengeluaran",
            lineTension: 0.3,
            backgroundColor: "rgba(255, 99, 132, 0.05)",
            borderColor: "rgba(255, 99, 132, 1)",
            pointRadius: 3,
            pointBackgroundColor: "rgba(255, 99, 132, 1)",
            pointBorderColor: "rgba(255, 99, 132, 1)",
            pointHoverRadius: 3,
            pointHoverBackgroundColor: "rgba(255, 99, 132, 1)",
            pointHoverBorderColor: "rgba(255, 99, 132, 1)",
            pointHitRadius: 10,
            pointBorderWidth: 2,
            data: {{ outcome_data|safe }}, // Data dummy
          },
          ],
        };
      
        // Konfigurasi chart area
        const areaConfig = {
          type: 'line',
          data: areaData,
          options: {
            maintainAspectRatio: false,
            layout: {
              padding: {
                left: 10,
                right: 25,
                top: 25,
                bottom: 0,
              },
            },
            scales: {
              xAxes: [
                {
                  time: {
                    unit: 'date',
                  },
                  gridLines: {
                    display: true,
                    drawBorder: true,
                  },
                  ticks: {
                    maxTicksLimit: 50,
                  },
                },
              ],
              yAxes: [
                {
                  ticks: {
                    maxTicksLimit: 5,
                    padding: 10,
                    callback: function (value) {
                    return 'Rp.' + value.toLocaleString();
                    },
                  },
                  gridLines: {
                    color: "rgb(234, 236, 244)",
                    zeroLineColor: "rgb(234, 236, 244)",
                    drawBorder: false,
                    borderDash: [2],
                    zeroLineBorderDash: [2],
                  },
                },
              ],
            },
            legend: {
              display: true, // Tampilkan legenda
              position: 'top', // Tempatkan legenda di atas chart
              labels: {
                fontColor: '#4e73df', // Warna teks legenda
              },
            },
            tooltips: {
              backgroundColor: "rgb(255,255,255)",
              bodyFontColor: "#858796",
              titleMarginBottom: 10,
              titleFontColor: '#6e707e',
              titleFontSize: 14,
              borderColor: '#dddfeb',
              borderWidth: 1,
              xPadding: 15,
              yPadding: 15,
              displayColors: false,
              intersect: false,
              mode: 'index',
              caretPadding: 10,
              callbacks: {
                label: function (tooltipItem, chart) {
                  var datasetLabel = chart.datasets[tooltipItem.datasetIndex].label || '';
                  return datasetLabel + ': Rp.' + tooltipItem.yLabel.toLocaleString();
                },
              },
            },
          },
        };
      
        // Membuat chart area
        var areaChart = new Chart(document.getElementById('myAreaChart'), areaConfig);
      
        // Data untuk chart pie
        const pieData = {
          labels: ["Pemasukan", "Pengeluaran", "Sisa"],
          datasets: [{
            data: [{{ total_pemasukan }}, {{ total_pengeluaran }}, {{ sisa_uang }}],  // Pastikan data dikirim sebagai angka
            backgroundColor: ['#4e73df', '#e74a3b', '#36b9cc'],
            hoverBackgroundColor: ['#2e59d9', '#e74a3b', '#2c9faf'],
            hoverBorderColor: "rgba(234, 236, 244, 1)",
          }],
        };
      
        // Konfigurasi chart pie
        
        const pieConfig = {
          type: 'doughnut',
          data: pieData,
          options: {
            maintainAspectRatio: false,
            tooltips: {
              backgroundColor: "rgb(255,255,255)",
              bodyFontColor: "#858796",
              borderColor: '#dddfeb',
              borderWidth: 1,
              xPadding: 15,
              yPadding: 15,
              displayColors: false,
              caretPadding: 10,
              callbacks: {
                // Mengubah cara tooltip ditampilkan
                label: function(tooltipItem, data) {
                  const dataset = data.datasets[tooltipItem.datasetIndex];
                  const total = dataset.data[tooltipItem.index];
                  // Menambahkan 'Rp' dan memformat angka dengan pemisah ribuan
                  return 'Rp' + total.toLocaleString(); 
                }
              }
            },
            legend: {
              display: false,
            },
            cutoutPercentage: 80,
          },
        };
      
        // Membuat chart pie
        var pieChart = new Chart(document.getElementById('myPieChart'), pieConfig);
      </script>
      
    </body>
  </html>
